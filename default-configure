#! /bin/bash

CONF_FILE="compiletime-settings"

if [ "$1" != "" ]; then
  if [ "${1#--}" = "$1" ]; then
    CONF_FILE=$1
    if [ "$CONF_FILE" = "-d" ]; then
      CONF_FILE=compiletime-settings.devel
    fi
    shift
  fi
fi

if [ ! -f $CONF_FILE ]; then
  echo "$CONF_FILE cannot be opened"
  exit 1
fi

SUFFIX=""
while [ "$1" != "" ]; do
  SUFFIX="$SUFFIX $1"
  shift
done

CONF=`cat $CONF_FILE`
CONF=`echo -n "$CONF"|tr '\n' ' '|cut '-d{' -f2|cut '-d}' -f1`

set $CONF

#echo "$*"

STRING=""

while [ "$1" != "" ]; do
#  echo "$1 $2"

  case "$1" in
    experimental)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-experimental"; fi
      ;;
    novm86plus)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-novm86plus"; fi
      ;;
    dodebug)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-dodebug"; fi
      ;;
    net)
      if [ "$2" = "off" ]; then STRING="$STRING --enable-nonet"; fi
      ;;
    x)
      if [ "$2" = "off" ]; then STRING="$STRING --without-x"; fi
      ;;
    mitshm)
      if [ "$2" = "off" ]; then STRING="$STRING --enable-nomitshm"; fi
      ;;
    sbemu)
      if [ "$2" = "off" ]; then STRING="$STRING --enable-nosbemu"; fi
      ;;
    slangforce)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-force-slang"; fi
      ;;
    tmonoton)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-monoton-timing"; fi
      ;;
    runasroot)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-runasroot"; fi
      ;;
    linkstatic)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-linkstatic"; fi
      ;;
    cpuemu)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-cpuemu"; fi
      ;;
    newint)
      if [ "$2" = "on" ]; then STRING="$STRING --enable-new-intcode"; fi
      ;;
    *)
      ;;
  esac

  shift; shift;
done

echo ". ./base-configure $STRING $SUFFIX"
. ./base-configure $STRING $SUFFIX
